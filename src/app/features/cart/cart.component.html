<main class="carrito-container">
  <div class="carrito-header">
    <h2>Tu carrito</h2>
    <button class="btn-link" (click)="clear()" *ngIf="(cartItems$ | async)?.length">Vaciar carrito</button>
  </div>

  <ng-container *ngIf="cartItems$ | async as items; else carritoVacio">
    <div class="carrito-content">
      <section class="productos">
        <div class="item" *ngFor="let item of items">
          <img [src]="item.imagen" [alt]="item.nombre">
          <div class="detalle">
            <h3>{{ item.nombre }}</h3>
            <p *ngIf="item.color">Color: {{ item.color }}</p>
            <p *ngIf="item.sku" class="sku">SKU: {{ item.sku }}</p>
            <div class="acciones">
              <div class="qty">
                <button (click)="decrease(item)">-</button>
                <span>{{ item.qty }}</span>
                <button (click)="increase(item)">+</button>
              </div>
              <strong>{{ (item.precio * item.qty) | currency:'COP':'symbol-narrow':'1.0-0' }}</strong>
            </div>
          </div>
          <button class="remove" (click)="remove(item)">Eliminar</button>
        </div>
      </section>

      <aside class="resumen">
        <h3>Resumen</h3>
        <div class="linea"></div>
        <div class="subtotal">
          <span>Productos ({{ totalItems$ | async }})</span>
          <strong>{{ (totalAmount$ | async) | currency:'COP':'symbol-narrow':'1.0-0' }}</strong>
        </div>
        <button class="btn-comprar" routerLink="/checkout">Ir a checkout</button>
      </aside>
    </div>
  </ng-container>

  <ng-template #carritoVacio>
    <div class="empty">
      <p>Tu carrito esta vacio. Explora nuestras colecciones.</p>
      <a routerLink="/products" class="btn-comprar">Ver productos</a>
    </div>
  </ng-template>
  <section class="interesar" *ngIf="recommendedProducts.length">
    <div class="interesar-title">
      <span class="line"></span>
      <h3>Te puede interesar</h3>
      <span class="line"></span>
    </div>
    <div class="interesar-grid">
      <article class="card" *ngFor="let prod of recommendedProducts" [routerLink]="['/products', prod.id]">
        <img [src]="prod.imagen" [alt]="prod.nombre">
        <h4>{{ prod.nombre }}</h4>
        <p>{{ prod.descripcionCorta }}</p>
        <div class="card-footer">
          <span>{{ prod.precio | currency:'COP':'symbol-narrow':'1.0-0' }}</span>
          <button type="button" (click)="addSuggested(prod, $event)">Agregar</button>
        </div>
      </article>
    </div>
  </section>
</main>
