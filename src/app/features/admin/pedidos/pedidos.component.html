<div class="admin-container">

  <!-- HEADER ADMIN -->
  <div class="admin-header">
    <h2>Gestión de pedidos</h2>
    <div class="admin-header-actions">
      <button class="btn-reset" type="button" (click)="irAProductos()">
        Volver a productos
      </button>
      <button class="btn-reset" type="button" (click)="irAAnalitica()">
        Analítica
      </button>
      <button (click)="logout()" class="logout-btn" title="Cerrar sesión">
        Cerrar sesión
      </button>
    </div>
  </div>

  <h3 class="titulo-lista">Pedidos</h3>

  <div class="filtros-bar pedidos-filtros" *ngIf="pedidos.length">
    <select [(ngModel)]="filtroEstado">
      <option value="">Todos los estados</option>
      <option *ngFor="let e of estadosPedido" [value]="e">{{ e }}</option>
    </select>
  </div>

  <div class="pedidos" *ngIf="pedidosFiltrados.length; else sinPedidos">
    <table class="tabla-productos tabla-pedidos">
      <thead>
        <tr>
          <th class="col-id">ID</th>
          <th class="col-cliente">Cliente</th>
          <th class="col-contacto">Contacto / envío</th>
          <th class="col-total">Total</th>
          <th class="col-estado">Estado</th>
          <th class="col-estado">Cambiar estado</th>
          <th class="col-guia">Guía envío</th>
          <th class="col-nota">Nota admin</th>
          <th class="col-items">Items</th>
          <th class="col-fecha">Fecha</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let p of pedidosFiltrados">
          <td class="col-id mono">{{ p.id }}</td>
          <td class="col-cliente">
            <div><strong>{{ p.nombreCliente || 'Sin nombre' }}</strong></div>
            <div class="mini-text">UID: {{ p.userId }}</div>
          </td>
          <td class="col-contacto">
            <div *ngIf="p.emailCliente">Email: {{ p.emailCliente }}</div>
            <div *ngIf="p.telefonoCliente">Tel: {{ p.telefonoCliente }}</div>
            <div *ngIf="p.direccionEnvio">
              Dirección: {{ p.direccionEnvio }},
              {{ p.ciudadEnvio }} - {{ p.departamentoEnvio }}
            </div>
          </td>
          <td class="col-total nowrap">
            {{ p.total | currency:'COP':'symbol':'1.0-0' }}
          </td>
          <td class="col-estado nowrap">
            {{ p.estado }}
          </td>
          <td class="col-estado">
            <select [ngModel]="p.estado" (ngModelChange)="cambiarEstadoPedido(p, $event)">
              <option *ngFor="let e of estadosPedido" [value]="e">{{ e }}</option>
            </select>
          </td>
          <td class="col-guia">
            <input
              class="mini-input"
              type="text"
              [(ngModel)]="p.guiaEnvio"
              placeholder="Guía"
            />
          </td>
          <td class="col-nota">
            <input
              class="mini-input"
              type="text"
              [(ngModel)]="p.notaAdmin"
              placeholder="Nota"
            />
          </td>
          <td class="col-items nowrap">
            {{ p.items.length || 0 }}
          </td>
          <td class="col-fecha nowrap">
            {{ p.createdAt?.toDate ? (p.createdAt.toDate() | date:'short') : '-' }}
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <ng-template #sinPedidos>
    <p class="filtro-resultado">No hay pedidos registrados.</p>
  </ng-template>

  <div
    class="toast-notification"
    *ngIf="toastActivo"
    [ngClass]="toastActivo.tipo"
    role="status"
    aria-live="assertive"
  >
    {{ toastActivo.texto }}
  </div>

</div>
